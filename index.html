<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Moments of Motherhood</title>
  <style>
    body {
      font-family: 'Cormorant Garamond', serif;
      text-align: center;
      margin-top: 40px;
      color: #222;
    }
    button {
      font-size: 18px;
      padding: 10px 20px;
      margin: 10px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      background-color: #ccc;
      color: #444;
    }
    button:disabled {
      background-color: #eee;
      color: #999;
      cursor: not-allowed;
    }
    video {
      margin-top: 20px;
      width: 90%;
      max-width: 400px;
    }
    #logo {
      margin-top: 30px;
      width: 200px;
    }
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }
    .toggle-switch input {
      display: none;
    }
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0; left: 0; right: 0; bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 24px;
    }
    .slider:before {
      position: absolute;
      content: "";
      height: 18px; width: 18px;
      left: 3px; bottom: 3px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }
    input:checked + .slider {
      background-color: #7a9330;
    }
    input:checked + .slider:before {
      transform: translateX(26px);
    }
  </style>
</head>
<body>
  <img id="logo" src="https://res.cloudinary.com/dpsiwijyq/image/upload/v1754367073/Moments_of_Motherhood_upfwmb.png" alt="Logo" />
  <h2>üéôÔ∏è Moments of Motherhood</h2>

  <label for="cameraToggle">Camera</label>
  <label class="toggle-switch">
    <input type="checkbox" id="cameraToggle" />
    <span class="slider"></span>
  </label>

  <br><br>
  <button id="startBtn">Start Recording</button>
  <button id="stopBtn" disabled>Stop Recording</button>
  <button id="pauseBtn" disabled>Pause</button>
  <button id="deleteBtn" disabled>Delete</button>
  <button id="submitBtn" disabled>Submit</button>

  <p id="statusText">Idle</p>

  <video id="preview" autoplay muted playsinline style="display: none;"></video>
  <video id="playback" controls style="display:none;"></video>

  <script>
    let mediaRecorder;
    let recordedChunks = [];
    let stream;
    let isPaused = false;
    let isVideo = false;

    const preview = document.getElementById("preview");
    const playback = document.getElementById("playback");
    const pauseBtn = document.getElementById("pauseBtn");
    const deleteBtn = document.getElementById("deleteBtn");
    const submitBtn = document.getElementById("submitBtn");
    const statusText = document.getElementById("statusText");
    const cameraToggle = document.getElementById("cameraToggle");
    const startBtn = document.getElementById("startBtn");
    const stopBtn = document.getElementById("stopBtn");

    async function startRecording() {
      recordedChunks = [];
      isVideo = cameraToggle.checked;

      try {
        stream = await navigator.mediaDevices.getUserMedia({
          audio: true,
          video: isVideo
        });

        preview.srcObject = stream;
        preview.style.display = isVideo ? 'block' : 'none';
        playback.style.display = "none";

        mediaRecorder = new MediaRecorder(stream);
        mediaRecorder.ondataavailable = (e) => {
          if (e.data.size > 0) recordedChunks.push(e.data);
        };
        mediaRecorder.onstop = () => {
          const blob = new Blob(recordedChunks, { type: "video/webm" });
          playback.src = URL.createObjectURL(blob);
          preview.style.display = "none";
          playback.style.display = "block";
        };

        mediaRecorder.start();
        statusText.textContent = "Recording...";
        startBtn.disabled = true;
        stopBtn.disabled = false;
        pauseBtn.disabled = false;
        deleteBtn.disabled = false;
        submitBtn.disabled = false;
      } catch (err) {
        alert("Error accessing media devices: " + err.message);
      }
    }

    function stopRecording() {
      if (mediaRecorder && mediaRecorder.state !== "inactive") {
        mediaRecorder.stop();
        stream.getTracks().forEach(track => track.stop());
        statusText.textContent = "Recording stopped.";
        stopBtn.disabled = true;
        pauseBtn.disabled = true;
      }
    }

    function pauseRecording() {
      if (!mediaRecorder) return;
      if (mediaRecorder.state === "recording") {
        mediaRecorder.pause();
        statusText.textContent = "Paused";
        pauseBtn.textContent = "Resume";
      } else if (mediaRecorder.state === "paused") {
        mediaRecorder.resume();
        statusText.textContent = "Recording...";
        pauseBtn.textContent = "Pause";
      }
    }

    function deleteRecording() {
      recordedChunks = [];
      playback.src = "";
      playback.style.display = "none";
      preview.srcObject = null;
      preview.style.display = "none";
      statusText.textContent = "Idle";

      pauseBtn.disabled = true;
      deleteBtn.disabled = true;
      submitBtn.disabled = true;
      stopBtn.disabled = true;
      startBtn.disabled = false;
      pauseBtn.textContent = "Pause";
    }

    function submitRecording() {
      const blob = new Blob(recordedChunks, { type: "video/webm" });
      const formData = new FormData();
      formData.append("file", blob);

      const userParam = new URLSearchParams(window.location.search).get("user") || "unknown";
      formData.append("user", userParam);

      fetch("https://hook.us1.make.com/YOUR-MAKE-ENDPOINT", {
        method: "POST",
        body: formData,
      }).then(() => {
        window.location.href = "https://momentsofmotherhood.glide.page";
      }).catch(error => {
        alert("Upload failed: " + error.message);
      });
    }
  </script>
</body>
</html>
