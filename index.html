<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Moments of Motherhood Recorder</title>
  <style>
    body {
      font-family: 'Cormorant Garamond', serif;
      text-align: center;
      background-color: #fffaf7;
      padding: 20px;
    }

    video, audio {
      margin: 20px auto;
      display: block;
      max-width: 90%;
      border-radius: 12px;
    }

    button {
      font-size: 16px;
      padding: 10px 20px;
      margin: 8px;
      border-radius: 8px;
      border: none;
      background-color: #e0e0e0;
      cursor: pointer;
      transition: 0.3s;
    }

    button:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
    }

    .hidden {
      display: none;
    }

    .status {
      font-size: 16px;
      margin-top: 10px;
    }
  </style>
</head>
<body>

  <img src="https://drive.google.com/uc?export=view&id=1qA2qqJgbIRDjv9oD_hdYopGEgRf_UBZi" alt="Logo" width="160" />

  <h2>Record Your Moment</h2>

  <video id="preview" autoplay muted class="hidden"></video>
  <video id="playback" controls class="hidden"></video>

  <div class="status" id="statusText">Press start when you're ready.</div>

  <div>
    <button id="toggleCameraBtn">Turn on Camera</button>
    <button id="startBtn">Start Recording</button>
    <button id="pauseBtn" disabled>Pause</button>
    <button id="deleteBtn" disabled>Delete</button>
    <button id="stopBtn" disabled>Stop</button>
    <button id="submitBtn" disabled>Submit</button>
  </div>

  <script>
    let mediaRecorder, chunks = [], stream;
    const preview = document.getElementById("preview");
    const playback = document.getElementById("playback");
    const toggleCameraBtn = document.getElementById("toggleCameraBtn");
    const startBtn = document.getElementById("startBtn");
    const pauseBtn = document.getElementById("pauseBtn");
    const stopBtn = document.getElementById("stopBtn");
    const deleteBtn = document.getElementById("deleteBtn");
    const submitBtn = document.getElementById("submitBtn");
    const statusText = document.getElementById("statusText");

    let isRecording = false;

    toggleCameraBtn.onclick = async () => {
      if (!stream) {
        try {
          stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
          preview.srcObject = stream;
          preview.classList.remove("hidden");
        } catch (err) {
          alert("Camera/microphone permission denied.");
        }
      } else {
        stream.getTracks().forEach(t => t.stop());
        stream = null;
        preview.srcObject = null;
        preview.classList.add("hidden");
      }
    };

    startBtn.onclick = () => {
      if (!stream) return alert("Please turn on your camera first.");

      chunks = [];
      mediaRecorder = new MediaRecorder(stream);
      mediaRecorder.ondataavailable = e => chunks.push(e.data);
      mediaRecorder.onstop = () => {
        const blob = new Blob(chunks, { type: "video/webm" });
        playback.src = URL.createObjectURL(blob);
        playback.classList.remove("hidden");
        preview.classList.add("hidden");
        submitBtn.disabled = false;
        statusText.textContent = "Recording complete. Review before submitting.";
      };

      mediaRecorder.start();
      isRecording = true;
      statusText.textContent = "Recording...";

      startBtn.disabled = true;
      pauseBtn.disabled = false;
      stopBtn.disabled = false;
      deleteBtn.disabled = false;
    };

    pauseBtn.onclick = () => {
      if (!mediaRecorder) return;
      if (mediaRecorder.state === "recording") {
        mediaRecorder.pause();
        pauseBtn.textContent = "Resume";
        statusText.textContent = "Paused.";
      } else if (mediaRecorder.state === "paused") {
        mediaRecorder.resume();
        pauseBtn.textContent = "Pause";
        statusText.textContent = "Recording...";
      }
    };

    stopBtn.onclick = () => {
      if (mediaRecorder && isRecording) {
        mediaRecorder.stop();
        isRecording = false;
        pauseBtn.disabled = true;
        stopBtn.disabled = true;
        deleteBtn.disabled = false;
        startBtn.disabled = false;
        toggleCameraBtn.disabled = false;
      }
    };

    deleteBtn.onclick = () => {
      chunks = [];
      playback.src = "";
      playback.classList.add("hidden");
      submitBtn.disabled = true;
      statusText.textContent = "Recording deleted. Ready to start again.";
    };

    submitBtn.onclick = () => {
      statusText.textContent = "Redirecting...";
      // Redirect to Glide app
      window.location.href = "https://momentsofmotherhood.glide.page";
    };
  </script>

</body>
</html>
